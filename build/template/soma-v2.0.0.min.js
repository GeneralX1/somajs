/*! soma.js - v2.0.0 - 2012-11-26
* http://www.soundstep.com/
* Copyright (c) 2012 Soundstep */
(function(e,t){"use strict";e.version="0.6.0";var n=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,r=/,/,i=/^\s*(_?)(\S+?)\1\s*$/,s=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg;Array.prototype.contains||(Array.prototype.contains=function(e){var t=this.length;while(t--)if(this[t]===e)return!0;return!1}),e.InjectorError={MAPPING_BAD_PROP:"[Error infuse.Injector.mapClass/mapValue] the first parameter is invalid, a string is expected",MAPPING_BAD_VALUE:"[Error infuse.Injector.mapClass/mapValue] the second parameter is invalid, it can't null or undefined, with property: ",MAPPING_BAD_CLASS:"[Error infuse.Injector.mapClass/mapValue] the second parameter is invalid, a function is expected, with property: ",MAPPING_BAD_SINGLETON:"[Error infuse.Injector.mapClass] the third parameter is invalid, a boolean is expected, with property: ",MAPPING_ALREADY_EXISTS:"[Error infuse.Injector.mapClass/mapValue] this mapping already exists, with property: ",CREATE_INSTANCE_INVALID_PARAM:"[Error infuse.Injector.createInstance] invalid parameter, a function is expected",NO_MAPPING_FOUND:"[Error infuse.Injector.getInstance] no mapping found",INJECT_INSTANCE_IN_ITSELF_PROPERTY:"[Error infuse.Injector.getInjectedValue] A matching property has been found in the target, you can't inject an instance in itself",INJECT_INSTANCE_IN_ITSELF_CONSTRUCTOR:"[Error infuse.Injector.getInjectedValue] A matching constructor parameter has been found in the target, you can't inject an instance in itself"};var o=function(e,t,n,r){this.prop=e,this.value=t,this.cl=n,this.singleton=r||!1},u=function(t){if(typeof t!="string")throw new Error(e.InjectorError.MAPPING_BAD_PROP)},a=function(t,n){if(!n)throw new Error(e.InjectorError.MAPPING_BAD_VALUE+t)},f=function(t,n){if(typeof n!="function")throw new Error(e.InjectorError.MAPPING_BAD_CLASS+t)},l=function(t,n){if(typeof n!="boolean")throw new Error(e.InjectorError.MAPPING_BAD_SINGLETON+t)},c=function(t,n){var r=e.getConstructorParams(n);if(r.contains(t))throw new Error(e.InjectorError.INJECT_INSTANCE_IN_ITSELF_CONSTRUCTOR)},h=function(t,n){if(n.hasOwnProperty(t))throw new Error(e.InjectorError.INJECT_INSTANCE_IN_ITSELF_PROPERTY)},p=function(){if(typeof arguments[0]!="function")throw new Error(e.InjectorError.CREATE_INSTANCE_INVALID_PARAM);var t=arguments[0],n=[null];for(var r=1;r<arguments.length;r++)n.push(arguments[r]);return new(Function.prototype.bind.apply(t,n))};e.Injector=function(){this.mappings={},this.parent=null},e.getConstructorParams=function(e){var t=[],o=e.toString().replace(s,""),u=o.match(n),a=u[1].split(r);for(var f=0;f<a.length;f++){var l=a[f];l.replace(i,function(e,n,r){t.push(r)})}return t},e.Injector.prototype={createChild:function(){var injector=new e.Injector;return injector.parent=this,injector},getMappingVo:function(e){return this.mappings?this.mappings[e]?this.mappings[e]:this.parent?this.parent.getMappingVo(e):null:null},mapValue:function(t,n){if(this.mappings[t])throw new Error(e.InjectorError.MAPPING_ALREADY_EXISTS+t);return u(t),a(t,n),this.mappings[t]=new o(t,n),this},mapClass:function(t,n,r){if(this.mappings[t])throw new Error(e.InjectorError.MAPPING_ALREADY_EXISTS+t);return u(t),f(t,n),r&&l(t,r),this.mappings[t]=new o(t,null,n,r),this},removeMapping:function(e){return this.mappings[e]=null,delete this.mappings[e],this},hasMapping:function(e){return!!this.mappings[e]},hasInheritedMapping:function(e){return!!this.getMappingVo(e)},getMapping:function(e){for(var t in this.mappings){var n=this.mappings[t];if(n.value===e||n.cl===e)return n.prop}},getValue:function(n){var r=this.mappings[n];if(!r){if(this.parent)return this.parent.getValue.apply(this.parent,arguments);throw new Error(e.InjectorError.NO_MAPPING_FOUND)}return r.cl?(arguments[0]=r.cl,this.getValueFromClass.apply(this,arguments)):r.value?r.value:t},getClass:function(e){var n=this.mappings[e];return n?n.cl?n.cl:t:this.parent?this.parent.getClass(e):t},instantiate:function(n){if(typeof n!="function")throw new Error(e.InjectorError.CREATE_INSTANCE_INVALID_PARAM);var n=arguments[0],r=[null],i=e.getConstructorParams(n,this.mappings);for(var s=0;s<i.length;s++)if(arguments[s+1])r.push(arguments[s+1]);else{var o=i[s],u=this.getMappingVo(o);if(!u)r.push(t);else{var a=this.getInjectedValue(u,o);r.push(a)}}return new(Function.prototype.bind.apply(n,r))},inject:function(e,t){this.parent&&this.parent.inject(e,!0);for(var n in this.mappings){var r=this.getMappingVo(n);if(e.hasOwnProperty(r.prop)){var i=this.getInjectedValue(r,n);e[n]=i}}return typeof e.postConstruct=="function"&&!t&&e.postConstruct(),this},getInjectedValue:function(t,n){var r=t.value,i;if(t.cl){var s=e.getConstructorParams(t.cl);t.singleton?(t.value||(c(n,t.cl),t.value=this.instantiate(t.cl),i=t.value),r=t.value):(c(n,t.cl),r=this.instantiate(t.cl),i=r)}return i&&(h(n,i),this.inject(i)),r},createInstance:function(){var instance=this.instantiate.apply(this,arguments);return this.inject(instance),instance},getValueFromClass:function(t){for(var n in this.mappings){var r=this.mappings[n];if(r.cl==t)return r.singleton?(r.value||(r.value=this.createInstance.apply(this,arguments)),r.value):this.createInstance.apply(this,arguments)}if(this.parent)return this.parent.getValueFromClass.apply(this.parent,arguments);throw new Error(e.InjectorError.NO_MAPPING_FOUND)},dispose:function(){this.mappings={}}},Function.prototype.bind||(Function.prototype.bind=function(t){var n=this;if(typeof n!="function")throw new Error("Error, you must bind a function.");var r=Array.prototype.slice.call(arguments,1),i=function(){if(this instanceof i){var e=function(){};e.prototype=n.prototype;var s=new e,o=n.apply(s,r.concat(Array.prototype.slice.call(arguments)));return Object(o)===o?o:s}return n.apply(t,r.concat(Array.prototype.slice.call(arguments)))};return i}),typeof define=="function"&&define.amd&&define("infuse",e),typeof exports!="undefined"&&(typeof module!="undefined"&&module.exports&&(exports=module.exports=e),exports=e)})(this.infuse=this.infuse||{}),function(e,t){"use strict";e.events={},e.events.version="0.5.2",Function.prototype.bind||(Function.prototype.bind=function(t){var n=this;if(typeof n!="function")throw new Error("Error, you must bind a function.");var r=Array.prototype.slice.call(arguments,1),i=function(){if(this instanceof i){var e=function(){};e.prototype=n.prototype;var s=new e,o=n.apply(s,r.concat(Array.prototype.slice.call(arguments)));return Object(o)===o?o:s}return n.apply(t,r.concat(Array.prototype.slice.call(arguments)))};return i}),e.Event=function(n,r,i,s){var o=e.Event.createGenericEvent(n,i,s);r!==null&&r!==t&&(o.params=r),o.isCloned=!1,o.clone=this.clone.bind(o),o.isIE9=this.isIE9,o.isDefaultPrevented=this.isDefaultPrevented;if(this.isIE9()||!o.preventDefault||o.getDefaultPrevented===t&&o.defaultPrevented===t)o.preventDefault=this.preventDefault.bind(o);return this.isIE9()&&(o.IE9PreventDefault=!1),o},e.Event.prototype.clone=function(){var t=e.Event.createGenericEvent(this.type,this.bubbles,this.cancelable);return t.params=this.params,t.isCloned=!0,t.clone=this.clone,t.isDefaultPrevented=this.isDefaultPrevented,t.isIE9=this.isIE9,this.isIE9()&&(t.IE9PreventDefault=this.IE9PreventDefault),t},e.Event.prototype.preventDefault=function(){return this.cancelable?(this.defaultPrevented=!0,this.isIE9()&&(this.IE9PreventDefault=!0),this):!1},e.Event.prototype.isDefaultPrevented=function(){return this.cancelable?this.isIE9()?this.IE9PreventDefault:this.defaultPrevented!==t?this.defaultPrevented:this.getDefaultPrevented!==t?this.getDefaultPrevented():!1:!1},e.Event.createGenericEvent=function(e,r,i){var s;return r=r!==t?r:!0,typeof document=="object"&&document.createEvent?(s=document.createEvent("Event"),s.initEvent(e,!!r,!!i)):typeof document=="object"&&document.createEventObject?(s=document.createEventObject(),s.type=e,s.bubbles=!!r,s.cancelable=!!i):s=new n(e,!!r,!!i),s},e.Event.prototype.isIE9=function(){return typeof document!="object"?!1:document.body.style.scrollbar3dLightColor!==t&&document.body.style.opacity!==t},e.Event.prototype.toString=function(){return"[soma.Event]"};var n=function(e,t,n){this.type=e,this.bubbles=!!t,this.cancelable=!!n,this.defaultPrevented=!1,this.currentTarget=null,this.target=null};e.EventDispatcher=function(){this.listeners=[]},e.EventDispatcher.prototype.addEventListener=function(e,t,n){if(!this.listeners||!e||!t)return;isNaN(n)&&(n=0);for(var r=0;r<this.listeners.length;r++){var i=this.listeners[r];if(i.type===e&&i.listener===t)return}this.listeners.push({type:e,listener:t,priority:n,scope:this})},e.EventDispatcher.prototype.removeEventListener=function(e,t){if(!this.listeners||!e||!t)return;var n=this.listeners.length;while(n-->0){var r=this.listeners[n];r.type===e&&r.listener===t&&this.listeners.splice(n,1)}},e.EventDispatcher.prototype.hasEventListener=function(e){if(!this.listeners||!e)return!1;var t=0,n=this.listeners.length;for(;t<n;++t){var r=this.listeners[t];if(r.type===e)return!0}return!1},e.EventDispatcher.prototype.dispatchEvent=function(e){if(!this.listeners||!e)throw new Error("Error in EventDispatcher (dispatchEvent), one of the parameters is null or undefined.");var t=[],n;for(n=0;n<this.listeners.length;n++){var r=this.listeners[n];r.type===e.type&&t.push(r)}t.sort(function(e,t){return t.priority-e.priority});for(n=0;n<t.length;n++)t[n].listener.apply(e.srcElement?e.srcElement:e.currentTarget,[e]);return!e.isDefaultPrevented()},e.EventDispatcher.prototype.dispatch=function(t,n,r,i){if(!this.listeners||!t||t==="")throw new Error("Error in EventDispatcher (dispatch), one of the parameters is null or undefined.");var s=new e.Event(t,n,r,i);return this.dispatchEvent(s),s},e.EventDispatcher.prototype.dispose=function(){this.listeners=null},e.EventDispatcher.prototype.toString=function(){return"[soma.EventDispatcher]"},typeof define=="function"&&define.amd&&define("soma-events",e),typeof exports!="undefined"&&(typeof module!="undefined"&&module.exports&&(exports=module.exports=e),exports=e)}(this.soma=this.soma||{}),function(e,t){"use strict";function p(e){return Object.prototype.toString.apply(e)==="[object Array]"}function d(e){return typeof e=="object"}function v(e){return typeof e=="string"}function m(e){return e?e.nodeType>0:!1}function g(e){return e&&e.nodeType&&e.nodeType===3}function y(e){return e&&typeof e=="function"}function b(e){return e!==null&&e!==t}function w(e){return e===""||e===!0||e==="true"||!b(e)}function E(e){return e&&y(e.toString)&&e.toString()==="[object Expression]"}function S(e){return e&&y(e.toString)&&e.toString()==="[object Node]"}function x(e){return v(e)?!!e.match(c.func):!1}function T(e){return!e||!m(e.element)?!1:e.parent&&at.get(e.element)?!0:!1}function N(e){return e.replace(c.escape,"\\$&")}function C(e,t){var n=a.start().replace(/\\/g,""),r="",i=t?e:n;i.length>1&&(r="|\\"+i.substr(0,1)+"(?!\\"+i.substr(1,1)+")[^"+i.substr(0,1)+"]*"),c.sequence=new RegExp(a.start()+".+?"+a.end()+"|[^"+a.start()+"]+"+r,"g"),c.token=new RegExp(a.start()+".*?"+a.end(),"g"),c.expression=new RegExp(a.start()+"|"+a.end(),"gm")}function k(e){return e.replace(c.trim,"")}function L(e){return c.string.test(e)?e.substr(1,e.length-2):e}function A(e){return e[0]===""&&e.shift(),e[e.length-1]===""&&e.pop(),e}function O(e){return e.replace(c.expression,"")}function M(e){return e.replace(c.depth,"")}function _(e,t){if(!e.parentNode)return;e.parentNode.insertBefore(t,e)}function D(e,t){if(!e.parentNode)return;e.parentNode.insertBefore(t,e.nextSibling)}function P(e,t){document.documentElement.classList?P=function(e,t){e.classList.remove(t)}:P=function(e,t){if(!e||!e.className)return!1;var n=new RegExp("(^|\\s)"+t+"(\\s|$)","g");e.className=e.className.replace(n,"$2")},P(e,t)}function H(){var e=function(e,t){for(t=e="";e++<36;t+=e*51&52?(e^15?8^Math.random()*(e^20?16:4):4).toString(16):"-");return t},t={},n=function(t){if(!t)return;if(typeof t!="object")return t;var n;try{n=t.hashkey?t.hashkey:t.hashkey=e()}catch(r){}return n};return{put:function(e,r){t[n(e)]=r},get:function(e){return t[n(e)]},remove:function(e){delete t[n(e)]},getData:function(){return t},dispose:function(){for(var e in t)t[e]=null,delete t[e]}}}function B(e,t){var n=e.match(c.repeat);if(!n)return;var r=n[2],i=new ut(r);return i.getValue(t)}function j(e,t,n){var r=e.match(c.repeat);if(!r)return;var i=r[1];t[i]=n}function F(e,t){var n=e.node||e.attribute.node,r=n.template.watchers,i=n.element;if(!r)return t;var s=r.get(i);!s&&g(n.element)&&n.parent&&(s=r.get(n.parent.element));var o=s?s:r.get(e.pattern);if(y(o)){var u=o(e.value,t,e.pattern,n.scope,n,e.attribute);if(b(u))return u}return t}function I(e,t){var n=W(t),r=e;while(n>0)r=r._parent?r._parent:r,n--;return r}function q(e,t){var n=new ut(t);return R(e,n.pattern,n.path,n.params,n.isFunction)}function R(e,n,r,i,s){if(c.string.test(n))return L(n);var o=[];if(!s&&i){var u=-1,a=i.length;while(++u<a)o.push(q(e,i[u]))}else o=s;var f=I(e,n);n=n.replace(/..\//g,""),r=r.replace(/..\//g,"");if(!f)return t;var l=f,h=r.split(/\.|\[|\]/g);if(h.length>0){var p=-1,d=h.length;while(++p<d){h[p]!==""&&(l=l[h[p]]);if(!b(l))return f._parent?R(f._parent,n,r,i,o):t}}return y(l)?l.apply(null,o):l}function U(e){var t=e.split("(")[0];return t=M(t),t}function z(e){return A(e.split(c.params))}function W(e){var t=e.split("(")[0],n=t.match(c.depth);return n?n.length:0}function X(e,t,n){var r=new it(e,t);r.previousSibling=e.previousSibling,r.nextSibling=e.nextSibling;var i=[];for(var s,o,a,f=e.attributes,l=0,c=f&&f.length;l<c;l++)s=f[l],s.specified&&(o=s.name,a=s.value,o===u.attributes.skip&&(r.skip=a===""||a==="true"),!n&&o===u.attributes.repeat&&(r.repeater=a),(V(o+":"+a)||o===u.attributes.repeat||o===u.attributes.show||o===u.attributes.hide||o===u.attributes.href||o===u.attributes.checked||o===u.attributes.disabled||o===u.attributes.multiple||o===u.attributes.readonly||o===u.attributes.selected||a.indexOf(u.attributes.cloak)!==-1)&&i.push(new st(o,a,r)));return r.attributes=i,r}function V(e){var t=e.match(c.token);return t&&t.length>0}function $(e){return c.content.test(e)}function J(e){if(!e)return;var t=e.nodeType;return!e||!t?!1:t===8?!1:t===3&&!$(e.nodeValue)&&!V(e.nodeValue)?!1:!0}function K(e,t,n,r){if(!J(t))return;var i;r?(i=r,i.parent=n):i=X(t,n?n.scope:(new rt(o))._createChild()),i.template=e;if(i.skip)return;var s=t.firstChild;while(s){var u=K(e,s,i);u&&(u.parent=i,i.children.push(u)),s=s.nextSibling}return i}function Q(e,t){G(e);for(var n in t)e[n]=t[n]}function G(e){for(var t in e)t.substr(0,1)!=="_"&&(e[t]=null,delete e[t])}function Y(e){if(T(e)||e.repeater||!e.children)return;var t=-1,n=e.children.length;while(++t<n)e.children[t].update()}function Z(e){if(T(e)||!e.children)return;var t=-1,n=e.children.length;while(++t<n)e.children[t].render()}function et(e){var t=B(e.repeater,e.scope),n;if(p(t)){var r=-1,i=t.length,s=e.childrenRepeater.length,o=i>s?i:s;while(++r<o)r<i?n=nt(e,r,t[r],l.index,r,n):(e.parent.element.removeChild(e.childrenRepeater[r].element),e.childrenRepeater[r].dispose());e.childrenRepeater.length>t.length&&(e.childrenRepeater.length=t.length)}else{var u=-1;for(var a in t)u++,n=nt(e,u,t[a],l.key,a,n);var f=u;while(u++<e.childrenRepeater.length-1)e.parent.element.removeChild(e.childrenRepeater[u].element),e.childrenRepeater[u].dispose();e.childrenRepeater.length=f+1}e.element.parentNode&&e.element.parentNode.removeChild(e.element)}function tt(e,t){var n=new it(e,t.scope._createChild());if(t.attributes){var r=-1,i=t.attributes.length,s=[];while(++r<i){t.attributes[r].name===u.attributes.skip&&(n.skip=t.attributes[r].value===""||t.attributes[r].value==="true");if(t.attributes[r].name!==f.repeat){var o=new st(t.attributes[r].name,t.attributes[r].value,n);s.push(o)}}n.isRepeaterDescendant=!0,n.attributes=s}return n}function nt(e,t,n,r,i,s){var o=e.childrenRepeater[t];if(!o){var u=e.element.cloneNode(!0),a=tt(u,e);return a.parent=e.parent,a.template=e.template,e.childrenRepeater[t]=a,j(e.repeater,a.scope,n),a.scope[r]=i,K(e.template,u,e.parent,a),a.update(),a.render(),s?D(s,u):e.previousSibling?D(e.previousSibling,u):e.nextSibling?_(e.nextSibling,u):e.parent.element.appendChild(u),u}return j(e.repeater,o.scope,n),o.scope[r]=i,o.update(),o.render(),o.element}function ct(e,t,n){var r=ht(t);n(r,r.scope,r.element,r.node)}function ht(t,n){var r;if(v(t)){if(!m(n))throw new Error(e.template.errors.TEMPLATE_STRING_NO_ELEMENT);n.innerHTML=t,r=n}else{if(!m(t))throw new Error(e.template.errors.TEMPLATE_NO_PARAM);m(n)?(n.innerHTML=t.innerHTML,r=n):r=t}pt(r)&&(pt(r).dispose(),at.remove(r));var i=new ft(r);return at.put(r,i),i}function pt(e){return m(e)?at.get(e):null}function dt(){for(var e in at.getData())at.get(e).render()}function vt(e){e===null&&(s={},o={});if(b(e)&&d(e))for(var t in e)e.hasOwnProperty(t)&&(s[t]=o[t]=e[t]);return s}e.template=e.template||{},e.template.version="0.0.5";var n=e.template.errors={TEMPLATE_STRING_NO_ELEMENT:"Error in soma.template, a string template requirement a second parameter: an element target - soma.template.create('string', element)",TEMPLATE_NO_PARAM:"Error in soma.template, a template requires at least 1 parameter - soma.template.create(element)"},r="{{",i="}}",s={},o={},u=e.template.settings=e.template.settings||{};u.autocreate=!0;var a=u.tokens={start:function(e){return b(e)&&e!==""&&(r=N(e),C(e,!0)),r},end:function(e){return b(e)&&e!==""&&(i=N(e),C(e,!1)),i}},f=u.attributes={skip:"data-skip",repeat:"data-repeat",src:"data-src",href:"data-href",show:"data-show",hide:"data-hide",cloak:"data-cloak",checked:"data-checked",disabled:"data-disabled",multiple:"data-multiple",readonly:"data-readonly",selected:"data-selected",template:"data-template"},l=u.vars={index:"$index",key:"$key"},c={sequence:null,token:null,expression:null,escape:/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,trim:/^[\s+]+|[\s+]+$/g,repeat:/(.*)\s+in\s+(.*)/,func:/(.*)\((.*)\)/,params:/,\s+|,|\s+,\s+/,quote:/\"|\'/g,content:/[^.|^\s]/gm,depth:/..\//g,string:/^(\"|\')(.*)(\"|\')$/},h=function(){var e,t=3,n=document.createElement("div"),r=n.getElementsByTagName("i");while(n.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",r[0]);return t>4?t:e}(),rt=function(e){function t(e){var t=n(e);return t._parent=this,this._children.push(t),t}function n(e){var n=e||{};return n._parent=null,n._children=[],n._createChild=function(e){return t.apply(n,arguments)},n}return n(e)},it=function(e,t){this.element=e,this.scope=t,this.attributes=null,this.value=null,this.interpolation=null,this.invalidate=!1,this.skip=!1,this.repeater=null,this.isRepeaterDescendant=!1,this.parent=null,this.children=[],this.childrenRepeater=[],this.previousSibling=null,this.nextSibling=null,this.template=null,g(this.element)&&(this.value=this.element.nodeValue,this.interpolation=new ot(this.value,this))};it.prototype={toString:function(){return"[object Node]"},dispose:function(){var e,t;if(this.children){e=-1,t=this.children.length;while(++e<t)this.children[e].dispose()}if(this.childrenRepeater){e=0,t=this.childrenRepeater.length;while(++e<t)this.childrenRepeater[e].dispose()}if(this.attributes){e=0,t=this.attributes.length;while(++e<t)this.attributes[e].dispose()}this.interpolation&&this.interpolation.dispose(),this.element=null,this.scope=null,this.attributes=null,this.attributesHashMap=null,this.value=null,this.interpolation=null,this.repeater=null,this.parent=null,this.children=null,this.childrenRepeater=null,this.previousSibling=null,this.nextSibling=null,this.template=null},getNode:function(e){var t;if(e===this.element)return this;if(this.childrenRepeater.length>0){var n=-1,r=this.childrenRepeater.length;while(++n<r){t=this.childrenRepeater[n].getNode(e);if(t)return t}}else{var i=-1,s=this.children.length;while(++i<s){t=this.children[i].getNode(e);if(t)return t}}return null},getAttribute:function(e){if(this.attributes){var t=-1,n=this.attributes.length;while(++t<n){var r=this.attributes[t];if(r.interpolationName&&r.interpolationName.value===e)return r}}},update:function(){if(T(this))return;b(this.interpolation)&&this.interpolation.update();if(b(this.attributes)){var e=-1,t=this.attributes.length;while(++e<t)this.attributes[e].update()}Y(this)},invalidateData:function(){if(T(this))return;this.invalidate=!0;var e,t;if(this.attributes){e=-1,t=this.attributes.length;while(++e<t)this.attributes[e].invalidate=!0}e=-1,t=this.childrenRepeater.length;while(++e<t)this.childrenRepeater[e].invalidateData();e=-1,t=this.children.length;while(++e<t)this.children[e].invalidateData()},render:function(){if(T(this))return;this.invalidate&&(this.invalidate=!1,g(this.element)&&(this.value=this.element.nodeValue=this.interpolation.render()));if(this.attributes){var e=-1,t=this.attributes.length;while(++e<t)this.attributes[e].render()}this.repeater?et(this):Z(this)}};var st=function(e,t,n){this.name=e,this.value=t,this.node=n,this.interpolationName=new ot(this.name,null,this),this.interpolationValue=new ot(this.value,null,this),this.invalidate=!1};st.prototype={toString:function(){return"[object Attribute]"},dispose:function(){this.interpolationName&&this.interpolationName.dispose(),this.interpolationValue&&this.interpolationValue.dispose(),this.interpolationName=null,this.interpolationValue=null,this.node=null,this.name=null,this.value=null,this.previousName=null},update:function(){this.interpolationName.update(),this.interpolationValue.update()},render:function(){function t(t,n){h===7&&t==="class"?e.className=n:e.setAttribute(t,n)}function n(t,n,r){w(n)?e.setAttribute(r,r):e.removeAttribute(r)}function r(t,n){e.setAttribute("src",n)}function i(t,n){e.setAttribute("href",n)}if(this.node.repeater)return;var e=this.node.element;this.invalidate&&(this.invalidate=!1,this.previousName=this.name,this.name=this.interpolationName.render()||this.name,this.value=this.interpolationValue.render()||this.value,this.name===f.src?r(this.name,this.value):this.name===f.href?i(this.name,this.value):((!this.node.isRepeaterDescendant||h!==7)&&this.node.element.removeAttribute(this.interpolationName.value),this.previousName&&(h===7&&this.previousName==="class"?this.node.element.className="":(!this.node.isRepeaterDescendant||h!==7)&&this.node.element.removeAttribute(this.previousName)),t(this.name,this.value,this.previousName))),this.name==="class"&&this.value.indexOf(u.attributes.cloak)!==-1&&P(this.node.element,u.attributes.cloak),this.name===f.hide&&(e.style.display=w(this.value)?"none":"block"),this.name===f.show&&(e.style.display=w(this.value)?"block":"none"),this.name===f.checked&&(h===7?e.checked=w(this.value)?!0:!1:n(this.name,this.value,"checked")),this.name===f.disabled&&n(this.name,this.value,"disabled"),this.name===f.multiple&&n(this.name,this.value,"multiple"),this.name===f.readonly&&(h===7?e.readOnly=w(this.value)?!0:!1:n(this.name,this.value,"readonly")),this.name===f.selected&&n(this.name,this.value,"selected")}};var ot=function(e,t,n){this.value=t&&!g(t.element)?k(e):e,this.node=t,this.attribute=n,this.sequence=[],this.expressions=[];var r=this.value.match(c.sequence);if(r){var i=-1,s=r.length;while(++i<s)if(r[i].match(c.token)){var o=new ut(O(r[i]),this.node,this.attribute);this.sequence.push(o),this.expressions.push(o)}else this.sequence.push(r[i]);A(this.sequence)}};ot.prototype={toString:function(){return"[object Interpolation]"},dispose:function(){if(this.expressions){var e=-1,t=this.expressions.length;while(++e<t)this.expressions[e].dispose()}this.value=null,this.node=null,this.attribute=null,this.sequence=null,this.expressions=null},update:function(){var e=-1,t=this.expressions.length;while(++e<t)this.expressions[e].update()},render:function(){var e="";if(this.sequence){var t=-1,n=this.sequence.length;while(++t<n){var r="";E(this.sequence[t])?r=this.sequence[t].value:r=this.sequence[t],b(r)||(r=""),e+=r}}return e}};var ut=function(e,n,r){if(!b(e))return;this.pattern=e,this.isString=c.string.test(e),this.node=n,this.attribute=r,this.value=this.isString?this.pattern:t,this.isString?(this.isFunction=!1,this.depth=null,this.path=null,this.params=null):(this.isFunction=x(this.pattern),this.depth=W(this.pattern),this.path=U(this.pattern),this.params=this.isFunction?z(this.pattern.match(c.func)[2]):null)};ut.prototype={toString:function(){return"[object Expression]"},dispose:function(){this.pattern=null,this.node=null,this.attribute=null,this.path=null,this.params=null,this.value=null},update:function(){var e=this.node;!e&&this.attribute&&(e=this.attribute.node);if(!e&&e.scope)return;var t=this.getValue(e.scope);t=F(this,t),this.value!==t&&(this.value=t,(this.node||this.attribute).invalidate=!0)},getValue:function(e){return R(e,this.pattern,this.path,this.params)}};var at=new H,ft=function(e){this.watchers=new H,this.node=null,this.scope=null,this.compile(e)};ft.prototype={toString:function(){return"[object Template]"},compile:function(e){e&&(this.element=e),this.node&&this.node.dispose(),this.node=K(this,this.element),this.node.root=!0,this.scope=this.node.scope},update:function(e){b(e)&&Q(this.node.scope,e),this.node&&this.node.update()},render:function(e){this.update(e),this.node&&this.node.render()},invalidate:function(){this.node&&this.node.invalidateData()},watch:function(e,t){if(!v(e)&&!m(e)||!y(t))return;this.watchers.put(e,t)},unwatch:function(e){this.watchers.remove(e)},clearWatchers:function(){this.watchers.dispose()},getNode:function(e){return this.node.getNode(e)},dispose:function(){at.remove(this.element),this.watchers&&this.watchers.dispose(),this.node&&this.node.dispose(),this.element=null,this.watchers=null,this.node=null}};if(u.autocreate){var lt=function(e,t){return t=document,e?function(e){var n=t.firstChild,r=function(){try{e(n.doScroll("left"))}catch(t){setTimeout(r,10)}};r()}:/webkit|safari|khtml/i.test(navigator.userAgent)?function(e){var n=function(){/loaded|complete/.test(t.readyState)?e():setTimeout(n,10)};n()}:function(e){t.addEventListener("DOMContentLoaded",e,!1)}}();lt(function(){var t=document.body.firstChild;while(t){if(t.nodeType===1){var n=t.getAttribute(f.template);if(n){var r=new Function("return "+n+";");try{var i=r();y(i)&&e.template.bootstrap(n,t,i)}catch(s){}}}t=t.nextSibling}})}a.start(r),a.end(i),e.template.create=ht,e.template.get=pt,e.template.renderAll=dt,e.template.helpers=vt,e.template.bootstrap=ct,typeof define=="function"&&define.amd&&define("soma-template",e.template),typeof exports!="undefined"&&(typeof module!="undefined"&&module.exports&&(exports=module.exports=e.template),exports=e.template)}(this.soma=this.soma||{}),function(e,t){function r(e){return e?e.nodeType>0:!1}e.template=e.template||{};var n=function(instance,injector){var t=instance.constructor.prototype;t.createTemplate=function(t,n){if(!t||typeof t!="function")throw new Error("Error creating a template, the first parameter must be a function.");if(n&&r(n)){var i=e.template.create(n);for(var s in i)typeof i[s]=="function"&&(t.prototype[s]=i[s].bind(i));t.prototype.render=i.render.bind(i);var o=this.injector.createChild();return o.mapValue("template",i),o.mapValue("scope",i.scope),o.mapValue("element",i.element),o.createInstance(t)}return null},e.template.bootstrap=function(e,t,n){instance.createTemplate(n,t)}};e.template.plugin=n,typeof define=="function"&&define.amd&&define("soma-template-plugin",e.template),typeof exports!="undefined"&&(typeof module!="undefined"&&module.exports&&(exports=module.exports=e.template.plugin),exports=e.template.plugin)}(this.soma=this.soma||{}),function(e,t){e.version="2.0.0",e.applyProperties=function(e,t,n){if(typeof n=="object"&&n instanceof Array&&n.length>0){var r=n.length;for(var i=0;i<r;i++)e[n[i]]||(e[n[i]]=t[n[i]].bind(t))}else for(var s in t)e[s]=t[s]},e.augment=function(e,t,n){if(!e.prototype||!t.prototype)return;if(typeof n=="object"&&n instanceof Array&&n.length>0){var r=n.length;for(var i=0;i<r;i++)if(!e.prototype[n[i]]||override)e.prototype[n[i]]=t.prototype[n[i]]}else for(var s in t.prototype)(!e.prototype[n[i]]||override)&&e.prototype[n[i]=t.prototype[n[i]]]},e.inherit=function(t,n){var r;n&&n.hasOwnProperty("constructor")?r=n.constructor:r=function(){return t.apply(this,arguments)},e.applyProperties(r.prototype,t.prototype);var i=function(){};return i.prototype=t.prototype,r.prototype=new i,n&&e.applyProperties(r.prototype,n,t.prototype),r.prototype.constructor=r,r.parent=t.prototype,r.extend=function(t){return e.inherit(r,t)},r},e.extend=function(t){return e.inherit(function(){},t)},e.Application=e.extend({constructor:function(){function t(){this.injector=new infuse.Injector(this.dispatcher),this.dispatcher=new e.EventDispatcher,e.applyProperties(this,this.dispatcher,["dispatchEvent","addEventListener","removeEventListener","hasEventListener"]),this.injector.mapValue("injector",this.injector),this.injector.mapValue("instance",this),this.injector.mapValue("dispatcher",this.dispatcher),this.injector.mapClass("mediators",n,!0),this.mediators=this.injector.getValue("mediators"),this.injector.mapClass("commands",r,!0),this.commands=this.injector.getValue("commands")}t.bind(this)(),this.init(),this.start()},createPlugin:function(){if(arguments.length==0||!arguments[0])throw new Error("Error creating a plugin, plugin class is missing.");var e=infuse.getConstructorParams(arguments[0]),t=[arguments[0]];for(var n=0;n<e.length;n++)(this.injector.hasMapping(e[n])||this.injector.hasInheritedMapping(e[n]))&&t.push(this.injector.getValue(e[n]));for(var n=1;n<arguments.length;n++)t.push(arguments[n]);return this.injector.createInstance.apply(this.injector,t)},init:function(){},start:function(){}});var n=e.extend({constructor:function(){this.injector=null},create:function(e,t){if(!e||typeof e!="function")throw new Error("Error creating a mediator, the first parameter must be a function.");if(typeof t=="object"&&t.length>0){var n=[],r=t.length;for(var i=0;i<r;i++){var injector=this.injector.createChild();injector.mapValue("injector",injector),injector.mapValue("target",t[i]);var s=injector.createInstance(e);n.push(s)}return n}}}),r=e.extend({constructor:function(){this.boundHandler=this.handler.bind(this),this.dispatcher=null,this.injector=null,this.list={}},has:function(e){return this.list[e]!=null},get:function(e){return this.hasCommand(e)?this.list[e]:null},getAll:function(){var e=[],t=this.list;for(var n in t)e.push(n);return e},add:function(e,t){if(this.has(e))throw new Error("Error in "+this+' Command "'+e+'" already registered.');if(this.has(typeof t!="function"))throw new Error("Error in "+this+' Command "'+t+'" must be a function, and contain an execute public method.');this.list[e]=t,this.addInterceptor(e)},remove:function(e){if(!this.hasCommand(e))return;this.list[e]=null,delete this.list[e],this.removeInterceptor(e)},addInterceptor:function(e){this.dispatcher.addEventListener(e,this.boundHandler,-Number.MAX_VALUE)},removeInterceptor:function(e){this.dispatcher.removeEventListener(e,this.boundHandler)},handler:function(e){e.isDefaultPrevented()||this.executeCommand(e)},executeCommand:function(e){var t=e.type;if(this.has(t)){var n=this.injector.createInstance(this.list[t]);if(!n.hasOwnProperty("execute")&&n.execute==="function")throw new Error("Error in "+this+' Command "'+n+'" must contain an execute public method.');n.execute(e)}}});typeof define=="function"&&define.amd&&define("soma",e),typeof exports!="undefined"&&(typeof module!="undefined"&&module.exports&&(exports=module.exports=e),exports=e)}(this.soma=this.soma||{});