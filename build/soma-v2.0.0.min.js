/*! soma.js - v2.0.0 - 2012-12-03
* http://www.soundstep.com/
* Copyright (c) 2012 Soundstep */
(function(e,t){"use strict";e.version="0.6.0";var n=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,r=/,/,i=/^\s*(_?)(\S+?)\1\s*$/,s=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg;Array.prototype.contains||(Array.prototype.contains=function(e){var t=this.length;while(t--)if(this[t]===e)return!0;return!1}),e.InjectorError={MAPPING_BAD_PROP:"[Error infuse.Injector.mapClass/mapValue] the first parameter is invalid, a string is expected",MAPPING_BAD_VALUE:"[Error infuse.Injector.mapClass/mapValue] the second parameter is invalid, it can't null or undefined, with property: ",MAPPING_BAD_CLASS:"[Error infuse.Injector.mapClass/mapValue] the second parameter is invalid, a function is expected, with property: ",MAPPING_BAD_SINGLETON:"[Error infuse.Injector.mapClass] the third parameter is invalid, a boolean is expected, with property: ",MAPPING_ALREADY_EXISTS:"[Error infuse.Injector.mapClass/mapValue] this mapping already exists, with property: ",CREATE_INSTANCE_INVALID_PARAM:"[Error infuse.Injector.createInstance] invalid parameter, a function is expected",NO_MAPPING_FOUND:"[Error infuse.Injector.getInstance] no mapping found",INJECT_INSTANCE_IN_ITSELF_PROPERTY:"[Error infuse.Injector.getInjectedValue] A matching property has been found in the target, you can't inject an instance in itself",INJECT_INSTANCE_IN_ITSELF_CONSTRUCTOR:"[Error infuse.Injector.getInjectedValue] A matching constructor parameter has been found in the target, you can't inject an instance in itself"};var o=function(e,t,n,r){this.prop=e,this.value=t,this.cl=n,this.singleton=r||!1},u=function(t){if(typeof t!="string")throw new Error(e.InjectorError.MAPPING_BAD_PROP)},a=function(t,n){if(!n)throw new Error(e.InjectorError.MAPPING_BAD_VALUE+t)},f=function(t,n){if(typeof n!="function")throw new Error(e.InjectorError.MAPPING_BAD_CLASS+t)},l=function(t,n){if(typeof n!="boolean")throw new Error(e.InjectorError.MAPPING_BAD_SINGLETON+t)},c=function(t,n){var r=e.getConstructorParams(n);if(r.contains(t))throw new Error(e.InjectorError.INJECT_INSTANCE_IN_ITSELF_CONSTRUCTOR)},h=function(t,n){if(n.hasOwnProperty(t))throw new Error(e.InjectorError.INJECT_INSTANCE_IN_ITSELF_PROPERTY)},p=function(){if(typeof arguments[0]!="function")throw new Error(e.InjectorError.CREATE_INSTANCE_INVALID_PARAM);var t=arguments[0],n=[null];for(var r=1;r<arguments.length;r++)n.push(arguments[r]);return new(Function.prototype.bind.apply(t,n))};e.Injector=function(){this.mappings={},this.parent=null},e.getConstructorParams=function(e){var t=[],o=e.toString().replace(s,""),u=o.match(n),a=u[1].split(r);for(var f=0;f<a.length;f++){var l=a[f];l.replace(i,function(e,n,r){t.push(r)})}return t},e.Injector.prototype={createChild:function(){var t=new e.Injector;return t.parent=this,t},getMappingVo:function(e){return this.mappings?this.mappings[e]?this.mappings[e]:this.parent?this.parent.getMappingVo(e):null:null},mapValue:function(t,n){if(this.mappings[t])throw new Error(e.InjectorError.MAPPING_ALREADY_EXISTS+t);return u(t),a(t,n),this.mappings[t]=new o(t,n),this},mapClass:function(t,n,r){if(this.mappings[t])throw new Error(e.InjectorError.MAPPING_ALREADY_EXISTS+t);return u(t),f(t,n),r&&l(t,r),this.mappings[t]=new o(t,null,n,r),this},removeMapping:function(e){return this.mappings[e]=null,delete this.mappings[e],this},hasMapping:function(e){return!!this.mappings[e]},hasInheritedMapping:function(e){return!!this.getMappingVo(e)},getMapping:function(e){for(var t in this.mappings){var n=this.mappings[t];if(n.value===e||n.cl===e)return n.prop}},getValue:function(n){var r=this.mappings[n];if(!r){if(this.parent)return this.parent.getValue.apply(this.parent,arguments);throw new Error(e.InjectorError.NO_MAPPING_FOUND)}return r.cl?(arguments[0]=r.cl,this.getValueFromClass.apply(this,arguments)):r.value?r.value:t},getClass:function(e){var n=this.mappings[e];return n?n.cl?n.cl:t:this.parent?this.parent.getClass(e):t},instantiate:function(n){if(typeof n!="function")throw new Error(e.InjectorError.CREATE_INSTANCE_INVALID_PARAM);var n=arguments[0],r=[null],i=e.getConstructorParams(n,this.mappings);for(var s=0;s<i.length;s++)if(arguments[s+1])r.push(arguments[s+1]);else{var o=i[s],u=this.getMappingVo(o);if(!u)r.push(t);else{var a=this.getInjectedValue(u,o);r.push(a)}}return new(Function.prototype.bind.apply(n,r))},inject:function(e,t){this.parent&&this.parent.inject(e,!0);for(var n in this.mappings){var r=this.getMappingVo(n);if(e.hasOwnProperty(r.prop)){var i=this.getInjectedValue(r,n);e[n]=i}}return typeof e.postConstruct=="function"&&!t&&e.postConstruct(),this},getInjectedValue:function(t,n){var r=t.value,i;if(t.cl){var s=e.getConstructorParams(t.cl);t.singleton?(t.value||(c(n,t.cl),t.value=this.instantiate(t.cl),i=t.value),r=t.value):(c(n,t.cl),r=this.instantiate(t.cl),i=r)}return i&&(h(n,i),this.inject(i)),r},createInstance:function(){var e=this.instantiate.apply(this,arguments);return this.inject(e),e},getValueFromClass:function(t){for(var n in this.mappings){var r=this.mappings[n];if(r.cl==t)return r.singleton?(r.value||(r.value=this.createInstance.apply(this,arguments)),r.value):this.createInstance.apply(this,arguments)}if(this.parent)return this.parent.getValueFromClass.apply(this.parent,arguments);throw new Error(e.InjectorError.NO_MAPPING_FOUND)},dispose:function(){this.mappings={}}},Function.prototype.bind||(Function.prototype.bind=function(t){var n=this;if(typeof n!="function")throw new Error("Error, you must bind a function.");var r=Array.prototype.slice.call(arguments,1),i=function(){if(this instanceof i){var e=function(){};e.prototype=n.prototype;var s=new e,o=n.apply(s,r.concat(Array.prototype.slice.call(arguments)));return Object(o)===o?o:s}return n.apply(t,r.concat(Array.prototype.slice.call(arguments)))};return i}),typeof define=="function"&&define.amd&&define("infuse",e),typeof exports!="undefined"&&(typeof module!="undefined"&&module.exports&&(exports=module.exports=e),exports=e)})(this.infuse=this.infuse||{}),function(e,t){"use strict";e.events={},e.events.version="0.5.2",Function.prototype.bind||(Function.prototype.bind=function(t){var n=this;if(typeof n!="function")throw new Error("Error, you must bind a function.");var r=Array.prototype.slice.call(arguments,1),i=function(){if(this instanceof i){var e=function(){};e.prototype=n.prototype;var s=new e,o=n.apply(s,r.concat(Array.prototype.slice.call(arguments)));return Object(o)===o?o:s}return n.apply(t,r.concat(Array.prototype.slice.call(arguments)))};return i}),e.Event=function(n,r,i,s){var o=e.Event.createGenericEvent(n,i,s);r!==null&&r!==t&&(o.params=r),o.isCloned=!1,o.clone=this.clone.bind(o),o.isIE9=this.isIE9,o.isDefaultPrevented=this.isDefaultPrevented;if(this.isIE9()||!o.preventDefault||o.getDefaultPrevented===t&&o.defaultPrevented===t)o.preventDefault=this.preventDefault.bind(o);return this.isIE9()&&(o.IE9PreventDefault=!1),o},e.Event.prototype.clone=function(){var t=e.Event.createGenericEvent(this.type,this.bubbles,this.cancelable);return t.params=this.params,t.isCloned=!0,t.clone=this.clone,t.isDefaultPrevented=this.isDefaultPrevented,t.isIE9=this.isIE9,this.isIE9()&&(t.IE9PreventDefault=this.IE9PreventDefault),t},e.Event.prototype.preventDefault=function(){return this.cancelable?(this.defaultPrevented=!0,this.isIE9()&&(this.IE9PreventDefault=!0),this):!1},e.Event.prototype.isDefaultPrevented=function(){return this.cancelable?this.isIE9()?this.IE9PreventDefault:this.defaultPrevented!==t?this.defaultPrevented:this.getDefaultPrevented!==t?this.getDefaultPrevented():!1:!1},e.Event.createGenericEvent=function(e,r,i){var s;return r=r!==t?r:!0,typeof document=="object"&&document.createEvent?(s=document.createEvent("Event"),s.initEvent(e,!!r,!!i)):typeof document=="object"&&document.createEventObject?(s=document.createEventObject(),s.type=e,s.bubbles=!!r,s.cancelable=!!i):s=new n(e,!!r,!!i),s},e.Event.prototype.isIE9=function(){return typeof document!="object"?!1:document.body.style.scrollbar3dLightColor!==t&&document.body.style.opacity!==t},e.Event.prototype.toString=function(){return"[soma.Event]"};var n=function(e,t,n){this.type=e,this.bubbles=!!t,this.cancelable=!!n,this.defaultPrevented=!1,this.currentTarget=null,this.target=null};e.EventDispatcher=function(){this.listeners=[]},e.EventDispatcher.prototype.addEventListener=function(e,t,n){if(!this.listeners||!e||!t)return;isNaN(n)&&(n=0);for(var r=0;r<this.listeners.length;r++){var i=this.listeners[r];if(i.type===e&&i.listener===t)return}this.listeners.push({type:e,listener:t,priority:n,scope:this})},e.EventDispatcher.prototype.removeEventListener=function(e,t){if(!this.listeners||!e||!t)return;var n=this.listeners.length;while(n-->0){var r=this.listeners[n];r.type===e&&r.listener===t&&this.listeners.splice(n,1)}},e.EventDispatcher.prototype.hasEventListener=function(e){if(!this.listeners||!e)return!1;var t=0,n=this.listeners.length;for(;t<n;++t){var r=this.listeners[t];if(r.type===e)return!0}return!1},e.EventDispatcher.prototype.dispatchEvent=function(e){if(!this.listeners||!e)throw new Error("Error in EventDispatcher (dispatchEvent), one of the parameters is null or undefined.");var t=[],n;for(n=0;n<this.listeners.length;n++){var r=this.listeners[n];r.type===e.type&&t.push(r)}t.sort(function(e,t){return t.priority-e.priority});for(n=0;n<t.length;n++)t[n].listener.apply(e.srcElement?e.srcElement:e.currentTarget,[e]);return!e.isDefaultPrevented()},e.EventDispatcher.prototype.dispatch=function(t,n,r,i){if(!this.listeners||!t||t==="")throw new Error("Error in EventDispatcher (dispatch), one of the parameters is null or undefined.");var s=new e.Event(t,n,r,i);return this.dispatchEvent(s),s},e.EventDispatcher.prototype.dispose=function(){this.listeners=null},e.EventDispatcher.prototype.toString=function(){return"[soma.EventDispatcher]"},typeof define=="function"&&define.amd&&define("soma-events",e),typeof exports!="undefined"&&(typeof module!="undefined"&&module.exports&&(exports=module.exports=e),exports=e)}(this.soma=this.soma||{}),function(e,t){"use strict";function c(e){return e?e.nodeType>0:!1}function h(e){return e&&typeof e=="function"}function p(e,t,n){if(e.addEventListener)e.addEventListener(t,n,!1);else{n.$$guid||(n.$$guid=p.guid++),e.events||(e.events={});var r=e.events[t];r||(r=e.events[t]={},e["on"+t]&&(r[0]=e["on"+t])),r[n.$$guid]=n,e["on"+t]=v}}function d(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.events&&e.events[t]&&delete e.events[t][n.$$guid]}function v(e){var t=!0;e=e||m(((this.ownerDocument||this.document||this).parentWindow||window).event);var n=this.events[e.type];for(var r in n)this.$$handleEvent=n[r],this.$$handleEvent(e)===!1&&(t=!1);return t}function m(e){return e.preventDefault=m.preventDefault,e.stopPropagation=m.stopPropagation,e}function y(e,t,n){var r=t.match(/(.*)\((.*)\)/);if(r){var i=r[1];if(h(e[i]))return e[i];if(e._parent)return y(e._parent,t,n)}}function b(e,n,i){r=i===t?Number.MAX_VALUE:i,w(e,n,0,!0)}function w(e,t,n,i){if(!c(e))throw new Error("Error in soma.interact.parse, only a DOM Element can be parsed.");i&&E(e,t);var s=e.firstChild;while(s)s.nodeType===1&&(n<r&&w(s,t,n++),E(s,t)),s=s.nextSibling}function E(e,t){var n=[];for(var r,i,o,u=e.attributes,a=0,f=u&&u.length;a<f;a++){r=u[a];if(r.specified){i=r.name,o=r.value;if(s.attributes[i]){var l=y(t,o,e);l&&(p(e,s.attributes[i],l),x(e,s.attributes[i],l))}}}}function S(e){var t=i.length,n=0;while(--t>=n){var r=i[t];if(e===r.element||g(e,r.element))d(r.element,r.type,r.handler),i.splice(t,1)}}function x(e,t,n){i.push({element:e,type:t,handler:n})}function T(e,t){}e.interact=e.interact||{},e.interact.version="0.0.1";var n=e.interact.errors={},r,i=[],s=e.interact.settings=e.interact.settings||{},o=s.attributes={};s.prefix="data";var u="click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup focus blur change select selectstart scroll copy cut paste mousewheel keypress error contextmenu input textinput drag dragenter dragleave dragover dragend dragstart dragover drop load submit reset search resize beforepaste beforecut beforecopy",a=u.split(" "),f=-1,l=a.length;while(++f<l)o[s.prefix+"-"+a[f]]=a[f];p.guid=1,m.preventDefault=function(){this.returnValue=!1},m.stopPropagation=function(){this.cancelBubble=!0};var g=document.documentElement.contains?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!(r&&r.nodeType===1&&n.contains&&n.contains(r))}:document.documentElement.compareDocumentPosition?function(e,t){return t&&!!(e.compareDocumentPosition(t)&16)}:function(e,t){while(t=t.parentNode)if(t===e)return!0;return!1};e.plugins=e.plugins||{},e.plugins&&e.plugins.add&&e.plugins.add(T),e.interact.parse=b,e.interact.clear=S,e.interact.addEvent=p,e.interact.removeEvent=d,typeof define=="function"&&define.amd&&define("soma-interact",e.interact),typeof exports!="undefined"&&(typeof module!="undefined"&&module.exports&&(exports=module.exports=e.interact),exports=e.interact)}(this.soma=this.soma||{}),function(e,t){function r(e){return e?e.nodeType>0:!1}e.version="2.0.0",e.applyProperties=function(e,t,n){if(typeof n=="object"&&n instanceof Array&&n.length>0){var r=n.length;for(var i=0;i<r;i++)e[n[i]]||(e[n[i]]=t[n[i]].bind(t))}else for(var s in t)e[s]=t[s]},e.augment=function(e,t,n){if(!e.prototype||!t.prototype)return;if(typeof n=="object"&&n instanceof Array&&n.length>0){var r=n.length;for(var i=0;i<r;i++)if(!e.prototype[n[i]]||override)e.prototype[n[i]]=t.prototype[n[i]]}else for(var s in t.prototype)(!e.prototype[n[i]]||override)&&e.prototype[n[i]=t.prototype[n[i]]]},e.inherit=function(t,n){var r;n&&n.hasOwnProperty("constructor")?r=n.constructor:r=function(){return t.apply(this,arguments)},e.applyProperties(r.prototype,t.prototype);var i=function(){};return i.prototype=t.prototype,r.prototype=new i,n&&e.applyProperties(r.prototype,n,t.prototype),r.prototype.constructor=r,r.parent=t.prototype,r.extend=function(t){return e.inherit(r,t)},r},e.extend=function(t){return e.inherit(function(){},t)};var n=[];e.plugins=e.plugins||{},e.plugins.add=function(e){n.push(e)},e.plugins.remove=function(e){var t=-1,r=n.length;while(++t<r)e===n[t]&&n.splice(t,1)},e.Application=e.extend({constructor:function(){function t(){this.injector=new infuse.Injector(this.dispatcher),this.dispatcher=new e.EventDispatcher,e.applyProperties(this,this.dispatcher,["dispatchEvent","addEventListener","removeEventListener","hasEventListener"]),this.injector.mapValue("injector",this.injector),this.injector.mapValue("instance",this),this.injector.mapValue("dispatcher",this.dispatcher),this.injector.mapClass("mediators",i,!0),this.mediators=this.injector.getValue("mediators"),this.injector.mapClass("commands",s,!0),this.commands=this.injector.getValue("commands");var t=-1,r=n.length;while(++t<r)this.createPlugin(n[t])}t.bind(this)(),this.init(),this.start()},createPlugin:function(){if(arguments.length==0||!arguments[0])throw new Error("Error creating a plugin, plugin class is missing.");var e=infuse.getConstructorParams(arguments[0]),t=[arguments[0]];for(var n=0;n<e.length;n++)(this.injector.hasMapping(e[n])||this.injector.hasInheritedMapping(e[n]))&&t.push(this.injector.getValue(e[n]));for(var n=1;n<arguments.length;n++)t.push(arguments[n]);return this.injector.createInstance.apply(this.injector,t)},init:function(){},start:function(){}});var i=e.extend({constructor:function(){this.injector=null},create:function(t,n){if(!t||typeof t!="function")throw new Error("Error creating a mediator, the first parameter must be a function.");if(typeof n=="object"&&n.length>0){var i=[],s=n.length;for(var o=0;o<s;o++){var u=this.injector.createChild();u.mapValue("injector",u),u.mapValue("target",n[o]);var a=u.createInstance(t);i.push(a),r(n[o])&&e.interact&&e.interact.parse(n[o],a)}return i}}}),s=e.extend({constructor:function(){this.boundHandler=this.handler.bind(this),this.dispatcher=null,this.injector=null,this.list={}},has:function(e){return this.list[e]!=null},get:function(e){return this.hasCommand(e)?this.list[e]:null},getAll:function(){var e=[],t=this.list;for(var n in t)e.push(n);return e},add:function(e,t){if(this.has(e))throw new Error("Error in "+this+' Command "'+e+'" already registered.');if(this.has(typeof t!="function"))throw new Error("Error in "+this+' Command "'+t+'" must be a function, and contain an execute public method.');this.list[e]=t,this.addInterceptor(e)},remove:function(e){if(!this.hasCommand(e))return;this.list[e]=null,delete this.list[e],this.removeInterceptor(e)},addInterceptor:function(e){this.dispatcher.addEventListener(e,this.boundHandler,-Number.MAX_VALUE)},removeInterceptor:function(e){this.dispatcher.removeEventListener(e,this.boundHandler)},handler:function(e){e.isDefaultPrevented()||this.executeCommand(e)},executeCommand:function(e){var t=e.type;if(this.has(t)){var n=this.injector.createInstance(this.list[t]);if(!n.hasOwnProperty("execute")&&n.execute==="function")throw new Error("Error in "+this+' Command "'+n+'" must contain an execute public method.');n.execute(e)}}});typeof define=="function"&&define.amd&&define("soma",e),typeof exports!="undefined"&&(typeof module!="undefined"&&module.exports&&(exports=module.exports=e),exports=e)}(this.soma=this.soma||{});