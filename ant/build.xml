<?xml version="1.0" encoding="UTF-8"?>
<project name="somacore.js" basedir="." default="build">

	<property file="user.properties"/>
	<property file="build.properties"/>

	<taskdef resource="net/sf/antcontrib/antlib.xml" >
		<classpath>
			<pathelement location="libs/ant-contrib-1.0b3.jar" />
		</classpath>
	</taskdef>

	<target name="build" description="build somacore" depends="minify, template"/>

	<target name="minify" description="compress somacore.js">
		<echo message="start minifying"/>
		<echo message="source: ${build.dir.source}/${build.project.name}.js"/>
		<echo message="target: ${build.dir.min}/${build.project.fullname.min}.js"/>
		<java jar="libs/yuicompressor-2.4.7.jar" fork="true">
			<arg value="${build.dir.source}/${build.project.name}.js"/>
			<arg value="-o"/>
			<arg value="${build.dir.min}/${build.project.fullname.min}.js"/>
	    </java>
		<mapper type="glob" from="*.js" to="*-min.js"/>
		<echo message="end minifying"/>
	</target>

	<target name="template" description="compress somacore.js">
		<echo message="start templates"/>
		<echo message="copy templates"/>
		<copydir src="${build.dir.templates.build}" dest="${build.dir.templates.temp}"/>
		<for list="compact,compact-namespace,standard,standard-namespace" param="templateName">
			<sequential>
				<!--framework-->
				<echo message="    > copy framework to template '@{templateName}'"/>
				<echo>      source: ${build.dir.min}/${build.file.framework.min}</echo>
				<echo>      target: ${build.dir.templates.temp}/@{templateName}/js/libs/${build.file.framework.export}</echo>
				<copy overwrite="true" file="${build.dir.min}/${build.file.framework.min}" tofile="${build.dir.templates.temp}/@{templateName}/js/libs/${build.file.framework.export}"/>
				<!--mootools-->
				<echo message="    > copy mootools to template '@{templateName}'"/>
				<echo>      source: ${build.dir.libs}/${build.file.mootools}</echo>
				<echo>      target: ${build.dir.templates.temp}/@{templateName}/js/libs/${build.file.mootools}</echo>
				<copy overwrite="true" file="${build.dir.libs}/${build.file.mootools}" tofile="${build.dir.templates.temp}/@{templateName}/js/libs/${build.file.mootools}"/>
			</sequential>
		</for>
		<echo message="replace tokens in ${build.dir.templates.build}/@{templateName}"/>
		<!--<replace dir="${build.dir.templates.build}">-->
			<!--<include name="**/*.html"/>-->
			<!--<replacefilter token="${build.token.framework.path}" value="js/libs/${build.file.framework.export}"/>-->
			<!--<replacefilter token="${build.token.mootools.path}" value="js/libs/${build.file.mootools}"/>-->
		<!--</replace>-->
		<zip destfile="${build.dir.templates.export}/${build.file.templates.export}" basedir="${build.dir.templates.build}"/>
		<echo message="end templates"/>
	</target>

</project>